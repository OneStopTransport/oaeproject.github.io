---
layout: post
title:  "Progress update"
date:   2012-11-19 11:08:16
author: Nicolaas Matthijs
---
<p class="heading2 mainText"><span style="font-size: xx-small;"><strong>Note: The progress update can be <a href="/static/blog-assets/26-performance/Sakai%20OAE%20Progress%20Report.pdf">downloaded</a> here as well.</strong></span></p><p class="heading2"><span style="font-size: medium;"><strong>1. Architecture update and technology choices</strong></span></p><p class="mainText" style="margin: 0.0px 0.0px 9.0px 0.0px;"><span style="letter-spacing: 0.0px;"> <span style="color: #000000; font-size: small;">The technology stack as outlined in our previous progress report remains largely unchanged. However, two modifications are worth noting:<br /><br /></span></span></p>
<!--more-->
<ul><li class="mainText"><span style="color: #000000;"><span style="font: normal normal normal 9px/normal 'Helvetica Neue'; letter-spacing: 0px;"><strong><span style="font-size: small;">Search:</span> </strong></span><span style="letter-spacing: 0.0px;"><span style="font-size: small;">Apache Solr has been switched out in favor of ElasticSearch. The main reason for making this change is the fact that ElasticSearch has been designed to be cloud aware, has built-in AWS EC2 knowledge and rack awareness, shards and partitions indexes out of the box, and provides horizontal and elastic scaling. This is all possible with Solr as well, but requires quite a bit more configuration to get things right. ElasticSearch also seems to be dealing better with a large number of query terms, and has some interesting multi-tenancy capabilities that we might want to use later on.</span><br /><br /></span></span></li><li><span class="mainText" style="font: normal normal normal 9px/normal 'Helvetica Neue'; letter-spacing: 0px; color: #000000;"><strong><span style="font-size: small;">File storage:</span> </strong></span><span style="letter-spacing: 0.0px;"><span class="mainText" style="color: #000000;"><span style="font-size: small;">Next to NFS and Amazon S3 storage, which were the storage solutions listed in the previous architectural diagram, we have also made it a goal to also natively support Google Cloud Storage, and provide extension points that make it easy to integrate with other content storage providers.</span><br /></span></span></li></ul><p>&nbsp;</p><p style="margin: 0.0px 0.0px 9.0px 0.0px; font: 12.0px Helvetica;"><br /><img style="display: block; vertical-align: middle;" src="/static/blog-assets/26-performance/Architecture.png" alt="Architecture diagram" width="557" /></p><p>&nbsp;</p><p class="heading2"><span style="font-size: medium;"><strong>2. Progress</strong></span></p><p style="margin: 0.0px 0.0px 9.0px 0.0px;"><span style="letter-spacing: 0.0px;"> <span style="font-size: small;">Progress has been made in a number of areas which we outline below. A lot of the work has focussed on foundational components, and quite a few of these are currently under review. Most of them have also had initial performance testing. The code should be merged into the codebase fairly soon and will then undergo further performance testing and optimizations where necessary.</span></span></p><p style="margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px 'Helvetica Neue'; color: #197da5;"><span style="letter-spacing: 0.0px;"><strong><br /> <span style="font-size: medium;">2.1. Performance testing and results</span></strong></span></p><p style="margin: 0.0px 0.0px 9.0px 0.0px;"><span style="letter-spacing: 0.0px;"> <br /><br /><span style="font-size: small;">A reference deployment of the new technology stack has been set up on the Joyent Cloud and is currently mostly used for ad-hoc and nightly performance testing. All of the individual components have been puppetized so they can easily be replicated, and the scripts for this can be found in the <a class="mainText" href="https://github.com/sakaiproject/puppet-hilary"><span style="text-decoration: underline; letter-spacing: 0.0px; color: #0b00ae;">https://github.com/sakaiproject/puppet-hilary</span></a></span><span style="font-size: small;"> repository. Most of the components are being used out-of-the-box and have not been tuned. The reference deployment is using the following machines:</span></span>&nbsp;</p><p>&nbsp;</p><table style="background-color: #ffffff; border-collapse: collapse; height: 289px; width: 1030px;" cellspacing="0" cellpadding="0"><tbody><tr><td style="width: 112.4px; height: 14.0px; background-color: #bdc0bf; border-style: solid; border-width: 1.0px; border-color: #000000 #000000 #000000 #000000; padding: 5.0px 5.0px 5.0px 5.0px;" valign="top"><p style="margin: 0.0px 0.0px 0.0px 0.0px; text-align: center; font: 10.0px 'Helvetica Neue'; color: #ffffff;"><span style="letter-spacing: 0px; font-size: small;"><strong>Type</strong></span></p></td><td style="width: 173.8px; height: 14.0px; background-color: #bdc0bf; border-style: solid; border-width: 1.0px; border-color: #000000 #000000 #000000 #000000; padding: 5.0px 5.0px 5.0px 5.0px;" valign="top"><p style="margin: 0.0px 0.0px 0.0px 0.0px; text-align: center; font: 10.0px 'Helvetica Neue'; color: #ffffff;"><span style="letter-spacing: 0px; font-size: small;"><strong>Spec</strong></span></p></td><td style="width: 121.2px; height: 14.0px; background-color: #bdc0bf; border-style: solid; border-width: 1.0px; border-color: #000000 #000000 #000000 #000000; padding: 5.0px 5.0px 5.0px 5.0px;" valign="top"><p style="margin: 0.0px 0.0px 0.0px 0.0px; text-align: center; font: 10.0px 'Helvetica Neue'; color: #ffffff;"><span style="letter-spacing: 0px; font-size: small;"><strong>Cost</strong></span></p></td></tr><tr><td style="width: 112.4px; height: 14.0px; border-style: solid; border-width: 1.0px; border-color: #000000 #000000 #000000 #000000; padding: 5.0px 5.0px 5.0px 5.0px;" valign="top"><p style="margin: 0.0px 0.0px 9.0px 0.0px; text-align: center; font: 10.0px 'Helvetica Neue Light';"><span style="letter-spacing: 0px; font-size: small;">Front-end</span></p></td><td style="width: 173.8px; height: 14.0px; border-style: solid; border-width: 1.0px; border-color: #000000 #000000 #000000 #000000; padding: 5.0px 5.0px 5.0px 5.0px;" valign="top"><p style="margin: 0.0px 0.0px 9.0px 0.0px; text-align: center; font: 10.0px 'Helvetica Neue Light';"><span style="letter-spacing: 0px; font-size: small;">1 XS (0.5 GB / 1 CPU) instance</span></p></td><td style="width: 121.2px; height: 14.0px; border-style: solid; border-width: 1.0px; border-color: #000000 #000000 #000000 #000000; padding: 5.0px 5.0px 5.0px 5.0px;" valign="top"><p style="margin: 0.0px 0.0px 9.0px 0.0px; text-align: center; font: 10.0px 'Helvetica Neue Light';"><span style="letter-spacing: 0px; font-size: small;">$21.90 / month</span></p></td></tr><tr><td style="width: 112.4px; height: 14.0px; border-style: solid; border-width: 1.0px; border-color: #000000 #000000 #000000 #000000; padding: 5.0px 5.0px 5.0px 5.0px;" valign="top"><p style="margin: 0.0px 0.0px 9.0px 0.0px; text-align: center; font: 10.0px 'Helvetica Neue Light';"><span style="letter-spacing: 0px; font-size: small;">App servers</span></p></td><td style="width: 173.8px; height: 14.0px; border-style: solid; border-width: 1.0px; border-color: #000000 #000000 #000000 #000000; padding: 5.0px 5.0px 5.0px 5.0px;" valign="top"><p style="margin: 0.0px 0.0px 9.0px 0.0px; text-align: center; font: 10.0px 'Helvetica Neue Light';"><span style="letter-spacing: 0px; font-size: small;">2 Medium (1 GB / 2 CPU) instances</span></p></td><td style="width: 121.2px; height: 14.0px; border-style: solid; border-width: 1.0px; border-color: #000000 #000000 #000000 #000000; padding: 5.0px 5.0px 5.0px 5.0px;" valign="top"><p style="margin: 0.0px 0.0px 9.0px 0.0px; text-align: center; font: 10.0px 'Helvetica Neue Light';"><span style="letter-spacing: 0px; font-size: small;">$124.10 / month / inst</span></p></td></tr><tr><td style="width: 112.4px; height: 14.0px; border-style: solid; border-width: 1.0px; border-color: #000000 #000000 #000000 #000000; padding: 5.0px 5.0px 5.0px 5.0px;" valign="top"><p style="margin: 0.0px 0.0px 9.0px 0.0px; text-align: center; font: 10.0px 'Helvetica Neue Light';"><span style="letter-spacing: 0px; font-size: small;">Database</span></p></td><td style="width: 173.8px; height: 14.0px; border-style: solid; border-width: 1.0px; border-color: #000000 #000000 #000000 #000000; padding: 5.0px 5.0px 5.0px 5.0px;" valign="top"><p style="margin: 0.0px 0.0px 9.0px 0.0px; text-align: center; font: 10.0px 'Helvetica Neue Light';"><span style="letter-spacing: 0px; font-size: small;">3 Large (8 GB / 2 CPU) instances</span></p></td><td style="width: 121.2px; height: 14.0px; border-style: solid; border-width: 1.0px; border-color: #000000 #000000 #000000 #000000; padding: 5.0px 5.0px 5.0px 5.0px;" valign="top"><p style="margin: 0.0px 0.0px 9.0px 0.0px; text-align: center; font: 10.0px 'Helvetica Neue Light';"><span style="letter-spacing: 0px; font-size: small;">$262.80 / month / inst</span></p></td></tr><tr><td style="width: 112.4px; height: 14.0px; border-style: solid; border-width: 1.0px; border-color: #000000 #000000 #000000 #000000; padding: 5.0px 5.0px 5.0px 5.0px;" valign="top"><p style="margin: 0.0px 0.0px 9.0px 0.0px; text-align: center; font: 10.0px 'Helvetica Neue Light';"><span style="letter-spacing: 0px; font-size: small;">Caching</span></p></td><td style="width: 173.8px; height: 14.0px; border-style: solid; border-width: 1.0px; border-color: #000000 #000000 #000000 #000000; padding: 5.0px 5.0px 5.0px 5.0px;" valign="top"><p style="margin-top: 0px; margin-right: 0px; margin-bottom: 9px; margin-left: 0px; font: normal normal normal 10px/normal 'Helvetica Neue Light'; text-align: center;"><span style="letter-spacing: 0px; font-size: small;">1 XS (0.5 GB / 1 CPU) instance</span></p></td><td style="width: 121.2px; height: 14.0px; border-style: solid; border-width: 1.0px; border-color: #000000 #000000 #000000 #000000; padding: 5.0px 5.0px 5.0px 5.0px;" valign="top"><p style="margin: 0.0px 0.0px 9.0px 0.0px; text-align: center; font: 10.0px 'Helvetica Neue Light';"><span style="letter-spacing: 0px; font-size: small;">$21.90 / month</span></p></td></tr><tr><td style="width: 112.4px; height: 14.0px; border-style: solid; border-width: 1.0px; border-color: #000000 #000000 #000000 #000000; padding: 5.0px 5.0px 5.0px 5.0px;" valign="top"><p style="margin: 0.0px 0.0px 9.0px 0.0px; text-align: center; font: 10.0px 'Helvetica Neue Light';"><span style="letter-spacing: 0px; font-size: small;">Search</span></p></td><td style="width: 173.8px; height: 14.0px; border-style: solid; border-width: 1.0px; border-color: #000000 #000000 #000000 #000000; padding: 5.0px 5.0px 5.0px 5.0px;" valign="top"><p style="margin: 0.0px 0.0px 9.0px 0.0px; text-align: center; font: 10.0px 'Helvetica Neue Light';"><span style="letter-spacing: 0px; font-size: small;">1 XS (0.5 GB / 1 CPU) instance</span></p></td><td style="width: 121.2px; height: 14.0px; border-style: solid; border-width: 1.0px; border-color: #000000 #000000 #000000 #000000; padding: 5.0px 5.0px 5.0px 5.0px;" valign="top"><p style="margin: 0.0px 0.0px 9.0px 0.0px; text-align: center; font: 10.0px 'Helvetica Neue Light';"><span style="letter-spacing: 0px; font-size: small;">$21.90 / month</span></p></td></tr><tr><td style="width: 112.4px; height: 28.0px; border-style: solid; border-width: 1.0px; border-color: #000000 #000000 #000000 #000000; padding: 5.0px 5.0px 5.0px 5.0px;" valign="top"><p style="margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica; min-height: 14.0px;">&nbsp;</p></td><td style="width: 173.8px; height: 28.0px; border-style: solid; border-width: 1.0px; border-color: #000000 #000000 #000000 #000000; padding: 5.0px 5.0px 5.0px 5.0px;" valign="top"><p style="margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica; min-height: 14.0px;">&nbsp;</p></td><td style="width: 121.2px; height: 28.0px; border-style: solid; border-width: 1.0px; border-color: #000000 #000000 #000000 #000000; padding: 5.0px 5.0px 5.0px 5.0px;" valign="top"><p style="margin: 0.0px 0.0px 9.0px 0.0px; text-align: center; font: 10.0px 'Helvetica Neue Light';"><span style="letter-spacing: 0px; font-size: small;">Total: $1,102.30 / month (excluding content storage)</span></p></td></tr></tbody></table><p>&nbsp;</p><p style="margin: 0.0px 0.0px 9.0px 0.0px;"><span style="letter-spacing: 0.0px;"> <span style="font-size: small;">The performance testing framework that has been set up consists of 2 parts, a data load and a Tsung performance test. First, a set of snapshotted data is restored when the environment is redeployed. This currently consists of 40,000 users, 80,000 groups and 200,000 content items. Once this is done, the OAE Model Loader (<a href="https://github.com/sakaiproject/OAE-model-loader"><span style="text-decoration: underline; letter-spacing: 0.0px; color: #0b00ae;">https://github.com/sakaiproject/OAE-model-loader</span></a>) will generate a new set of 10,000 users, 20,000 groups and 50,000 content items and will load these into the system. This data load is monitored and allows us to check the speed at which data can be inserted into the system.</span></span></p><p style="margin: 0.0px 0.0px 9.0px 0.0px;"><span style="letter-spacing: 0px; font-size: small;">In order to do the actual load testing, we have decided to continue using Tsung, which is an Erlang-based load testing tool that simulates user sessions and provides various reporting capabilities. An additional Node.js module has been written that facilitates the creation of Tsung XML test files, and is used to create a large number of random user sessions that reflect real user behavior as closely as possible. Unfortunately, all of this is based on best guestimates as we don't have access to any OAE production logs.</span>&nbsp;</p><p style="margin: 0.0px 0.0px 9.0px 0.0px;"><span style="letter-spacing: 0px; font-size: small;">Once all of the data is loaded into the system, the Tsung load test is kicked off. Various waves will be run during which additional sets of users are added until we find the breaking point (for the current infrastructure). The reporting is done twofold, by using the Native Tsung reports and by pushing Telemetry data into Circonus (see below). A separate blog post will be written that goes into more detail on all of this.</span>&nbsp;</p><p style="margin: 0.0px 0.0px 9.0px 0.0px;"><span style="letter-spacing: 0px; font-size: small;">When the first tests were run, we were able to quickly identify a number of performance issues in permission checks. Various solutions have been tried and we believe that these issues are now fixed.</span></p><p style="margin: 0.0px 0.0px 9.0px 0.0px;"><span style="letter-spacing: 0px; font-size: small;">This has allowed us to set a performance baseline that we'll be validating against as we move forwards. The Tsung results for this baseline test can be found at <a href="http://165.225.132.68/2012/11/13/17/00/tsung/20121113-1730/report.html"><span style="text-decoration: underline; letter-spacing: 0.0px; color: #0b00ae;">http://165.225.132.68/2012/11/13/17/00/tsung/20121113-1730/report.html</span></a> and the Circonus average response times chart for this test can be found at <a href="https://circonus.com/embedded/graphs/5bbd2647-be58-6419-eeea-90ee7bb1cef5/68D29H"><span style="text-decoration: underline; letter-spacing: 0.0px; color: #0b00ae;">https://circonus.com/embedded/graphs/5bbd2647-be58-6419-eeea-90ee7bb1cef5/68D29H</span></a>.&nbsp;</span></p><p style="margin: 0.0px 0.0px 9.0px 0.0px;"><span style="letter-spacing: 0px; font-size: small;">The test is comprised of a number of waves that have an increasing number of new users arriving every second. The first wave has an arrival rate of 4.6 new users/second, which is incrementally increased until it hits the last wave at 13.6 new users/second. As shown in the chart below, that final wave is the first one that crosses the 1 second mean transaction (page load) time threshold, even though it's not making the servers unstable yet.<br /><br /></span></p><p>&nbsp;</p><p style="margin: 0.0px 0.0px 9.0px 0.0px;"><span style="font: 12.0px Helvetica;"><img style="display: block; margin-left: auto; margin-right: auto;" src="http://165.225.132.68/2012/11/13/17/00/tsung/20121113-1730/images/graphes-Transactions-mean.png" alt="pastedGraphic_1.pdf" width="600" /><br /></span></p><p style="margin: 0.0px 0.0px 9.0px 0.0px;"><span style="letter-spacing: 0px; font-size: small;">This generates the following performance baseline for the infrastructure that's being used:</span>&nbsp;<br />&nbsp;</p><table style="background-color: #ffffff; border-collapse: collapse;" cellspacing="0" cellpadding="0"><tbody><tr><td style="width: 145.4px; height: 14.0px; background-color: #bdc0bf; border-style: solid; border-width: 1.0px; border-color: #000000 #000000 #000000 #000000; padding: 5.0px 5.0px 5.0px 5.0px;" valign="top"><p style="margin: 0.0px 0.0px 0.0px 0.0px; text-align: center; font: 10.0px 'Helvetica Neue'; color: #ffffff;"><span style="letter-spacing: 0px; font-size: small;"><strong>Metric</strong></span></p></td><td style="width: 115.0px; height: 14.0px; background-color: #bdc0bf; border-style: solid; border-width: 1.0px; border-color: #000000 #000000 #000000 #000000; padding: 5.0px 5.0px 5.0px 5.0px;" valign="top"><p style="margin: 0.0px 0.0px 0.0px 0.0px; text-align: center; font: 10.0px 'Helvetica Neue'; color: #ffffff;"><span style="letter-spacing: 0px; font-size: small;"><strong>Result</strong></span></p></td></tr><tr><td style="width: 145.4px; height: 14.0px; border-style: solid; border-width: 1.0px; border-color: #000000 #000000 #000000 #000000; padding: 5.0px 5.0px 5.0px 5.0px;" valign="top"><p style="margin: 0.0px 0.0px 9.0px 0.0px; text-align: center; font: 10.0px 'Helvetica Neue Light';"><span style="letter-spacing: 0px; font-size: small;">Simultaneous users</span></p></td><td style="width: 115.0px; height: 14.0px; border-style: solid; border-width: 1.0px; border-color: #000000 #000000 #000000 #000000; padding: 5.0px 5.0px 5.0px 5.0px;" valign="top"><p style="margin: 0.0px 0.0px 9.0px 0.0px; text-align: center; font: 10.0px 'Helvetica Neue Light';"><span style="letter-spacing: 0px; font-size: small;">+- 5,800 users</span></p></td></tr><tr><td style="width: 145.4px; height: 14.0px; border-style: solid; border-width: 1.0px; border-color: #000000 #000000 #000000 #000000; padding: 5.0px 5.0px 5.0px 5.0px;" valign="top"><p style="margin: 0.0px 0.0px 9.0px 0.0px; text-align: center; font: 10.0px 'Helvetica Neue Light';"><span style="letter-spacing: 0px; font-size: small;">Requests per second</span></p></td><td style="width: 115.0px; height: 14.0px; border-style: solid; border-width: 1.0px; border-color: #000000 #000000 #000000 #000000; padding: 5.0px 5.0px 5.0px 5.0px;" valign="top"><p style="margin: 0.0px 0.0px 9.0px 0.0px; text-align: center; font: 10.0px 'Helvetica Neue Light';"><span style="letter-spacing: 0px; font-size: small;">+- 1,050 req/s</span></p></td></tr></tbody></table><p><span style="letter-spacing: 0px; font-size: small;"><br />An hour long performance test with an arrival rate of around 10 new users/second manages to remain stable throughout and ends up doing a little under 4 million HTTP requests during that time.</span></p><p><span style="letter-spacing: 0px; font-size: small;">Obviously, these tests are only testing the functionality that's already been re-implemented. Once new features are implemented, the baseline will either go up or down, although efforts will be undertaken to keep the numbers as close as possible to what they are currently.</span></p><p>&nbsp;</p><p style="margin: 0.0px 0.0px 9.0px 0.0px; text-align: center;"><span style="font: 12.0px Helvetica;"><img src="http://165.225.132.68/2012/11/13/17/00/tsung/20121113-1730/images/graphes-Users-simultaneous.png" alt="pastedGraphic_2.pdf" width="600" /><br /></span><span style="letter-spacing: 0px; font-size: x-small;">Concurrent users<br /></span><span style="font: 12.0px Helvetica;"><img src="http://165.225.132.68/2012/11/13/17/00/tsung/20121113-1730/images/graphes-HTTP_CODE-rate.png" alt="pastedGraphic_3.pdf" width="600" /><br />HTTP requests per second</span></p><p>&nbsp;</p><p style="margin: 0.0px 0.0px 9.0px 0.0px;"><span style="letter-spacing: 0px; font-size: small;">In order to investigate the linear scalability characteristics of the current architecture, we have doubled the number of app servers and have added 2 additional Cassandra nodes. This generated the following results:<br /><br /></span></p><table style="background-color: #ffffff; border-collapse: collapse;" cellspacing="0" cellpadding="0"><tbody><tr><td style="width: 145.4px; height: 14.0px; background-color: #bdc0bf; border-style: solid; border-width: 1.0px; border-color: #000000 #000000 #000000 #000000; padding: 5.0px 5.0px 5.0px 5.0px;" valign="top"><p style="margin: 0.0px 0.0px 0.0px 0.0px; text-align: center; font: 10.0px 'Helvetica Neue'; color: #ffffff;"><span style="letter-spacing: 0px; font-size: small;"><strong>Metric</strong></span></p></td><td style="width: 115.0px; height: 14.0px; background-color: #bdc0bf; border-style: solid; border-width: 1.0px; border-color: #000000 #000000 #000000 #000000; padding: 5.0px 5.0px 5.0px 5.0px;" valign="top"><p style="margin: 0.0px 0.0px 0.0px 0.0px; text-align: center; font: 10.0px 'Helvetica Neue'; color: #ffffff;"><span style="letter-spacing: 0px; font-size: small;"><strong>Result</strong></span></p></td></tr><tr><td style="width: 145.4px; height: 14.0px; border-style: solid; border-width: 1.0px; border-color: #000000 #000000 #000000 #000000; padding: 5.0px 5.0px 5.0px 5.0px;" valign="top"><p style="margin: 0.0px 0.0px 9.0px 0.0px; text-align: center; font: 10.0px 'Helvetica Neue Light';"><span style="letter-spacing: 0px; font-size: small;">Simultaneous users</span></p></td><td style="width: 115.0px; height: 14.0px; border-style: solid; border-width: 1.0px; border-color: #000000 #000000 #000000 #000000; padding: 5.0px 5.0px 5.0px 5.0px;" valign="top"><p style="margin: 0.0px 0.0px 9.0px 0.0px; text-align: center; font: 10.0px 'Helvetica Neue Light';"><span style="letter-spacing: 0px; font-size: small;">+- 12,000 users</span></p></td></tr><tr><td style="width: 145.4px; height: 14.0px; border-style: solid; border-width: 1.0px; border-color: #000000 #000000 #000000 #000000; padding: 5.0px 5.0px 5.0px 5.0px;" valign="top"><p style="margin: 0.0px 0.0px 9.0px 0.0px; text-align: center; font: 10.0px 'Helvetica Neue Light';"><span style="letter-spacing: 0px; font-size: small;">Requests per second</span></p></td><td style="width: 115.0px; height: 14.0px; border-style: solid; border-width: 1.0px; border-color: #000000 #000000 #000000 #000000; padding: 5.0px 5.0px 5.0px 5.0px;" valign="top"><p style="margin: 0.0px 0.0px 9.0px 0.0px; text-align: center; font: 10.0px 'Helvetica Neue Light';"><span style="letter-spacing: 0px; font-size: small;">+- 2,000 req/s</span></p></td></tr></tbody></table><p><span style="letter-spacing: 0px; font-size: small;"><br />This shows that doubling the available infrastructure will double the system's capabilities and we can thus be fairly confident that the system will scale horizontally in a linear way, which is in line with expectations as the technology choices have been made with this in mind. Obviously, in the next month we will be performing these tests with search and file uploads included as well.</span></p><p>&nbsp;</p><p style="margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px 'Helvetica Neue'; color: #197da5;"><span style="font-size: small;"><span style="font: 12.0px Helvetica; color: #000000;"><img style="display: block; margin-left: auto; margin-right: auto;" src="http://165.225.132.68/2012/11/13/17/00/tsung/20121113-1730/images/graphes-HTTP_CODE-rate.png" alt="pastedGraphic_4.pdf" width="600" /></span></span></p><p style="margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px 'Helvetica Neue'; color: #197da5;"><span style="font-size: small;"><span style="letter-spacing: 0.0px;"><strong>&nbsp;</strong></span></span></p><p style="margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px 'Helvetica Neue'; color: #197da5;"><span style="font-size: medium;"><span style="letter-spacing: 0.0px;"><strong><br />2.2. Search</strong></span></span>&nbsp;</p><p style="margin: 0.0px 0.0px 9.0px 0.0px;"><span style="letter-spacing: 0px; font-size: small;"><br /> Search has been implemented into the Hilary back-end using ElasticSearch, and is currently under review. Like Solr, ElasticSearch is a Lucene-based free-text search server that can be accessed via a RESTful API. ElasticSearch has been built from the ground up with the elastic scalability expected from a cloud deployment in mind, and provides a variety of great tools that make administration of such a cluster of nodes easier. There are additional features such as dynamic index creation, schema-less design, and cross-index searches that make it an extensible and flexible choice.</span></p><p style="margin: 0.0px 0.0px 9.0px 0.0px;"><span style="letter-spacing: 0px; font-size: small;">The OAE "General Search" has been implemented in the Hilary backend, and there are more planned in the design (Library search, Memberships search). The General Search implementation exercises some of the higher risk aspects of search such as access-scoping searching, and the stability and performance of the search platform itself. After a series of performance tests, we've found that ElasticSearch's performance itself hasn't proven to be a bottleneck to the system, however more testing of its limitations is still expected.</span></p><p style="margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px 'Helvetica Neue'; color: #197da5;"><span style="letter-spacing: 0px; font-size: small;"><strong><span style="font-size: medium;"><br />2.3. File storage and preview generation<br /><br /></span></strong></span></p><p style="margin: 0.0px 0.0px 9.0px 0.0px;"><span style="letter-spacing: 0px; font-size: small;"> There is currently a pull request under review for the re-introduction of file uploads, including file revisions, using Node.js Formidable to handle the file uploads and Nginx to handle the downloads. Two initial implementations have been created, one that allows local NFS storage and one that allows storing data into Amazon S3. Later on, Google Cloud Storage will also be provided.</span></p><p style="margin: 0.0px 0.0px 9.0px 0.0px;"><span style="letter-spacing: 0px; font-size: small;">Preview and thumbnail generation has also been re-implemented, based on the rSmart/Erik Froese Nakamura preview processor. It uses RabbitMQ to queue the content items that need preview processing and can thus be horizontally scaled.</span></p><p style="margin: 0.0px 0.0px 9.0px 0.0px;"><span style="letter-spacing: 0px; font-size: small;">This component has been built with extensibility in mind, and provides an interface that allows for new storage providers to be integrated.</span></p><p style="margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px 'Helvetica Neue'; color: #197da5;"><span style="letter-spacing: 0px; font-size: small;"><strong><br /><span style="font-size: medium;">2.4. UI integration</span></strong></span></p><p style="margin: 0.0px 0.0px 9.0px 0.0px;"><span style="letter-spacing: 0px; font-size: small;"> <br />An initial set of UI integration work is currently under review as well. It re-enables basic functionality like creating an account, logging in, logging out, profiles, my library, my memberships, creating a content item, managing a content item, etc. This will be added to the reference environment in the next week or so.</span>&nbsp;</p><p style="margin: 0.0px 0.0px 9.0px 0.0px;"><span style="letter-spacing: 0px; font-size: small;">We have also started refactoring, cleaning up and simplifying all of the client-side Sakai APIs, in order to reflect the refactoring of business logic previously embedded in the UI but now removed to the back-end. This should also help make widget development more straightforward.</span></p><p style="margin: 0.0px 0.0px 9.0px 0.0px;"><span style="letter-spacing: 0px; font-size: small;">Widget development will also start using the node package manager (NPM) for distributing and installing widgets.</span></p><p style="margin: 0.0px 0.0px 9.0px 0.0px;"><span style="letter-spacing: 0px; font-size: small;">The existing UI production build system, which concatenates, minifies and hashes the UI files has been re-implemented using Grunt.</span>&nbsp;</p><p style="margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px 'Helvetica Neue'; color: #197da5;"><span style="letter-spacing: 0px; font-size: small;"><strong><br /><span style="font-size: medium;">2.5. Admin UI</span></strong></span></p><p><span style="letter-spacing: 0px; font-size: small;"><br />The administrative UI has been continuously extended to include more configuration types (array configurations, tree configurations, etc.). A lot of the existing configuration options that were part of the client-side configuration file have been moved into back-end config descriptor files, which will allow for the retirement of the client-side config file.</span></p><p style="margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px 'Helvetica Neue'; color: #197da5;"><span style="letter-spacing: 0px; font-size: small;"><strong><br /><span style="font-size: medium;">2.6. Documentation UI</span></strong></span></p><p><span style="letter-spacing: 0px; font-size: small;"><br />Using the Node.js Dox module, a User Interface has been created that ships with the main codebase and shows the documentation of the Hilary API functions. This should make it easier for (widget) developers to discover and use the available API functions. The current documentation UI can be found at <a href="http://t1.oae-performance.sakaiproject.org"><span style="text-decoration: underline; letter-spacing: 0.0px; color: #0b00ae;">http://t1.oae-performance.sakaiproject.org</span></a>/.</span></p><p style="margin: 0.0px 0.0px 9.0px 0.0px;"><span style="letter-spacing: 0px; font-size: small;">There is currently also a pull request under review that significantly improves the quality of this documentation.</span></p><p>&nbsp;</p><p style="margin: 0.0px 0.0px 9.0px 0.0px;"><span style="font-size: small;"><span style="font: 12.0px Helvetica;"><img style="display: block;" src="/static/blog-assets/26-performance/Screen%20Shot%202012-11-19%20at%2011.53.53.png" alt="Documentation UI" width="600" /></span><span style="letter-spacing: 0.0px;"><br /> </span></span></p><p>&nbsp;</p><p style="margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px 'Helvetica Neue'; color: #197da5;"><span style="letter-spacing: 0px; font-size: medium;"><strong>2.7. User ID association</strong></span></p><p style="margin: 0.0px 0.0px 9.0px 0.0px;"><span style="letter-spacing: 0px; font-size: small;"> <br />The Hilary back-end has moved away from using the login id as a user's internal id, and a pull request is currently under review where all users have an internal id that can be mapped against one or more login ids. These login ids can be institutional ids (SSO), Google, Facebook, Twitter, etc., depending on which authentication providers the tenant allows.</span>&nbsp;</p><p style="margin: 0.0px 0.0px 9.0px 0.0px;"><span style="letter-spacing: 0px; font-size: small;">This makes it for example possible for a user to log into the same account using his institutional id and his Google account, or for a user to continue using the same account after his institutional id has changed.</span>&nbsp;</p><p style="margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px 'Helvetica Neue'; color: #197da5;"><span style="letter-spacing: 0px; font-size: small;"><strong><br /><span style="font-size: medium;">2.8. Unit testing</span></strong></span></p><p style="margin: 0.0px 0.0px 9.0px 0.0px;"><span style="letter-spacing: 0px; font-size: small;"> <br />The unit testing suite has been re-factored to use the REST endpoints where possible. This has led to the creation of an OAE REST module, which describes all of the available REST endpoints and makes it easy for deployers to create, add, update or remove users, group, content, permissions, etc.. This module can be pulled out into other projects and can be used to easily interface with a running OAE instance.</span></p><p style="margin: 0.0px 0.0px 9.0px 0.0px;"><span style="letter-spacing: 0px; font-size: small;">There's been a continuous effort to increase the unit test coverage, which currently stands at 92%.<br /> </span></p><p>&nbsp;</p><p style="margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px 'Helvetica Neue'; color: #197da5;"><span style="letter-spacing: 0px; font-size: small;"><strong><span style="font-size: medium;">2.9. User and group provider design</span></strong></span></p><p style="margin: 0.0px 0.0px 9.0px 0.0px;"><span style="letter-spacing: 0px; font-size: small;"> <br />Conversations have started about the need for a User provider and a Group provider for Sakai OAE. There was an initial conversation with people from Edia about this, where they shared their previous experiences integrating Sakai CLE and Sakai OAE with OpenConext. We agreed to continue working together on a design for these providers, and to publish these to the wider community after the first iteration. The idea is to take the Sakai CLE User and Group providers as a starting point, as these have been production hardened and have been valued because of their extensibility.</span>&nbsp;</p><p style="margin: 0.0px 0.0px 9.0px 0.0px;"><span style="letter-spacing: 0px; font-size: small;">Edia has shown interest in validating the design and implementation by creating an OpenConext integration.</span></p><p>&nbsp;</p><p class="heading2"><span style="font-size: medium;"><strong>3. Next steps</strong></span></p><p style="margin: 0.0px 0.0px 9.0px 0.0px;"><span style="letter-spacing: 0px; font-size: small;"> Between now and Christmas, the team will be focussing on the following tasks:<br /><br /></span></p><ul><li><span style="font-size: small;">Continued UI integration work and client-side API improvements. Once search and file upload are merged, the UI should be hooked up to these as well.</span></li><li><span style="font-size: small;">Improved tenant separation by allowing tenants to be completely private to other tenants.</span></li><li><span style="font-size: small;">Implement additional search endpoints for Library search and Membership searches.</span></li><li><span style="font-size: small;">Continued performance testing for file storage, preview generation and search.</span></li><li><span style="font-size: small;">Implementation of commenting capabilities, including replying to comments.</span></li><li><span style="font-size: small;">Implementation of activities, based on <a href="http://activitystrea.ms/specs/json/1.0/"><span style="text-decoration: underline; letter-spacing: 0.0px; color: #0b00ae;">http://activitystrea.ms/specs/json/1.0/</span></a>.</span></li><li><span style="font-size: small;">Design of Sakai Doc REST API.</span></li></ul><p style="margin: 0.0px 0.0px 9.0px 0.0px;"><span style="letter-spacing: 0px; font-size: small;"><br /> This is our current best estimate of where we think we can be by the end of the year. This would be quite significantly ahead of the plan made in the beginning of September and would represents a large part of the existing OAE functionality. However, it is obviously not yet feature complete.</span></p><p style="margin: 0.0px 0.0px 9.0px 0.0px;"><span style="letter-spacing: 0.0px;"><span style="font-size: small;">We still recommend the end of the year for a new go-ahead decision based on the progress made against the points mentioned above. If there is a decision to move ahead, a prioritization exercise should be organized to determine which new features and capabilities should be implemented first.</span><br /> </span></p><p>&nbsp;</p><p style="margin: 0.0px 0.0px 9.0px 0.0px;"><span style="letter-spacing: 0.0px;">&nbsp;</span></p>
